var rangy;var rangyLoaded=false;function loadRangy(){if(rangyLoaded){return}rangyLoaded=true;window.rangy=(function(){var j="object",g="function",z="undefined";var k=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var c=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var r=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var o=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function i(C,B){var A=typeof C[B];return A==g||(!!(A==j&&C[B]))||A=="unknown"}function d(B,A){return !!(typeof B[A]==j&&B[A])}function p(B,A){return typeof B[A]!=z}function l(A){return function(D,C){var B=C.length;while(B--){if(!A(D,C[B])){return false}}return true}}var n=l(i);var q=l(d);var y=l(p);function u(A){return A&&n(A,o)&&y(A,r)}var m={version:"1.2.2",initialized:false,supported:true,util:{isHostMethod:i,isHostObject:d,isHostProperty:p,areHostMethods:n,areHostObjects:q,areHostProperties:y,isTextRange:u},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function f(A){window.alert("Rangy not supported in your browser. Reason: "+A);m.initialized=true;m.supported=false}m.fail=f;function t(B){var A="Rangy warning: "+B;if(m.config.alertOnWarn){window.alert(A)}else{if(typeof window.console!=z&&typeof window.console.log!=z){window.console.log(A)}}}m.warn=t;if({}.hasOwnProperty){m.util.extend=function(C,B){for(var A in B){if(B.hasOwnProperty(A)){C[A]=B[A]}}}}else{f("hasOwnProperty not supported")}var v=[];var a=[];function s(){if(m.initialized){return}var C;var G=false,H=false;if(i(document,"createRange")){C=document.createRange();if(n(C,c)&&y(C,k)){G=true}C.detach()}var B=d(document,"body")?document.body:document.getElementsByTagName("body")[0];if(B&&i(B,"createTextRange")){C=B.createTextRange();if(u(C)){H=true}}if(!G&&!H){f("Neither Range nor TextRange are implemented")}m.initialized=true;m.features={implementsDomRange:G,implementsTextRange:H};var F=a.concat(v);for(var E=0,A=F.length;E<A;++E){try{F[E](m)}catch(D){if(d(window,"console")&&i(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",D)}}}}m.init=s;m.addInitListener=function(A){if(m.initialized){A(m)}else{v.push(A)}};var w=[];m.addCreateMissingNativeApiListener=function(A){w.push(A)};function e(C){C=C||window;s();for(var B=0,A=w.length;B<A;++B){w[B](C)}}m.createMissingNativeApi=e;function x(A){this.name=A;this.initialized=false;this.supported=false}x.prototype.fail=function(A){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+A)};x.prototype.warn=function(A){m.warn("Module "+this.name+": "+A)};x.prototype.createError=function(A){return new Error("Error in Rangy "+this.name+" module: "+A)};m.createModule=function(A,C){var B=new x(A);m.modules[A]=B;a.push(function(D){C(D,B);B.initialized=true;B.supported=true})};m.requireModules=function(C){for(var E=0,A=C.length,D,B;E<A;++E){B=C[E];D=m.modules[B];if(!D||!(D instanceof x)){throw new Error("Module '"+B+"' not found")}if(!D.supported){throw new Error("Module '"+B+"' not supported")}}};var b=false;var h=function(A){if(!b){b=true;if(!m.initialized){s()}}};if(typeof window==z){f("No window found");return}if(typeof document==z){f("No document found");return}if(i(document,"addEventListener")){document.addEventListener("DOMContentLoaded",h,false)}if(i(window,"addEventListener")){window.addEventListener("load",h,false)}else{if(i(window,"attachEvent")){window.attachEvent("onload",h)}else{f("Window does not have required addEventListener or attachEvent method")}}return m})();rangy.createModule("DomUtil",function(p,d){var t="undefined";var b=p.util;if(!b.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){d.fail("document missing a Node creation method")}if(!b.isHostMethod(document,"getElementsByTagName")){d.fail("document missing getElementsByTagName method")}var e=document.createElement("div");if(!b.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!b.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))){d.fail("Incomplete Element implementation")}if(!b.isHostProperty(e,"innerHTML")){d.fail("Element is missing innerHTML property")}var s=document.createTextNode("test");if(!b.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!b.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!b.areHostProperties(s,["data"]))){d.fail("Incomplete Text Node implementation")}var y=function(E,G){var F=E.length;while(F--){if(E[F]===G){return true}}return false};function i(F){var E;return typeof F.namespaceURI==t||((E=F.namespaceURI)===null||E=="http://www.w3.org/1999/xhtml")}function j(F){var E=F.parentNode;return(E.nodeType==1)?E:null}function a(F){var E=0;while((F=F.previousSibling)){E++}return E}function g(E){var F;return m(E)?E.length:((F=E.childNodes)?F.length:0)}function x(F,E){var G=[],H;for(H=F;H;H=H.parentNode){G.push(H)}for(H=E;H;H=H.parentNode){if(y(G,H)){return H}}return null}function C(E,F,H){var G=H?F:F.parentNode;while(G){if(G===E){return true}else{G=G.parentNode}}return false}function z(F,E,I){var G,H=I?F:F.parentNode;while(H){G=H.parentNode;if(G===E){return H}H=G}return null}function m(F){var E=F.nodeType;return E==3||E==4||E==8}function v(H,F){var E=F.nextSibling,G=F.parentNode;if(E){G.insertBefore(H,E)}else{G.appendChild(H)}return H}function w(G,E){var F=G.cloneNode(false);F.deleteData(0,E);G.deleteData(E,G.length-E);v(F,G);return F}function q(E){if(E.nodeType==9){return E}else{if(typeof E.ownerDocument!=t){return E.ownerDocument}else{if(typeof E.document!=t){return E.document}else{if(E.parentNode){return q(E.parentNode)}else{throw new Error("getDocument: no document found for node")}}}}}function l(E){var F=q(E);if(typeof F.defaultView!=t){return F.defaultView}else{if(typeof F.parentWindow!=t){return F.parentWindow}else{throw new Error("Cannot get a window object for node")}}}function B(E){if(typeof E.contentDocument!=t){return E.contentDocument}else{if(typeof E.contentWindow!=t){return E.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}}function f(E){if(typeof E.contentWindow!=t){return E.contentWindow}else{if(typeof E.contentDocument!=t){return E.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}}function D(E){return b.isHostObject(E,"body")?E.body:E.getElementsByTagName("body")[0]}function c(F){var E;while((E=F.parentNode)){F=E}return F}function r(H,J,G,I){var E,K,M,L,F;if(H==G){return J===I?0:(J<I)?-1:1}else{if((E=z(G,H,true))){return J<=a(E)?-1:1}else{if((E=z(H,G,true))){return a(E)<I?-1:1}else{K=x(H,G);M=(H===K)?K:z(H,K,true);L=(G===K)?K:z(G,K,true);if(M===L){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{F=K.firstChild;while(F){if(F===M){return -1}else{if(F===L){return 1}}F=F.nextSibling}throw new Error("Should not be here!")}}}}}function A(F){var E=q(F).createDocumentFragment(),G;while((G=F.firstChild)){E.appendChild(G)}return E}function o(E){if(!E){return"[No node]"}if(m(E)){return'"'+E.data+'"'}else{if(E.nodeType==1){var F=E.id?' id="'+E.id+'"':"";return"<"+E.nodeName+F+">["+E.childNodes.length+"]"}else{return E.nodeName}}}function n(E){this.root=E;this._next=E}n.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var G=this._current=this._next;var F,E;if(this._current){F=G.firstChild;if(F){this._next=F}else{E=null;while((G!==this.root)&&!(E=G.nextSibling)){G=G.parentNode}this._next=E}}return this._current},detach:function(){this._current=this._next=this.root=null}};function h(E){return new n(E)}function k(E,F){this.node=E;this.offset=F}k.prototype={equals:function(E){return this.node===E.node&this.offset==E.offset},inspect:function(){return"[DomPosition("+o(this.node)+":"+this.offset+")]"}};function u(E){this.code=this[E];this.codeName=E;this.message="DOMException: "+this.codeName}u.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};u.prototype.toString=function(){return this.message};p.dom={arrayContains:y,isHtmlNamespace:i,parentElement:j,getNodeIndex:a,getNodeLength:g,getCommonAncestor:x,isAncestorOf:C,getClosestAncestorIn:z,isCharacterDataNode:m,insertAfter:v,splitDataNode:w,getDocument:q,getWindow:l,getIframeWindow:f,getIframeDocument:B,getBody:D,getRootContainer:c,comparePoints:r,inspectNode:o,fragmentFromNodeChildren:A,createIterator:h,DomPosition:k};p.DOMException=u});rangy.createModule("DomRange",function(i,f){i.requireModules(["DomUtil"]);var b=i.dom;var E=b.DomPosition;var T=i.DOMException;function x(al,e){return(al.nodeType!=3)&&(b.isAncestorOf(al,e.startContainer,true)||b.isAncestorOf(al,e.endContainer,true))}function m(e){return b.getDocument(e.startContainer)}function u(al,ap,am){var ao=al._listeners[ap];if(ao){for(var an=0,e=ao.length;an<e;++an){ao[an].call(al,{target:al,args:am})}}}function A(e){return new E(e.parentNode,b.getNodeIndex(e))}function W(e){return new E(e.parentNode,b.getNodeIndex(e)+1)}function j(al,an,am){var e=al.nodeType==11?al.firstChild:al;if(b.isCharacterDataNode(an)){if(am==an.length){b.insertAfter(al,an)}else{an.parentNode.insertBefore(al,am==0?an:b.splitDataNode(an,am))}}else{if(am>=an.childNodes.length){an.appendChild(al)}else{an.insertBefore(al,an.childNodes[am])}}return e}function H(am){var al;for(var an,ao=m(am.range).createDocumentFragment(),e;an=am.next();){al=am.isPartiallySelectedSubtree();an=an.cloneNode(!al);if(al){e=am.getSubtreeIterator();an.appendChild(H(e));e.detach(true)}if(an.nodeType==10){throw new T("HIERARCHY_REQUEST_ERR")}ao.appendChild(an)}return ao}function V(al,ao,e){var am,aq;e=e||{stop:false};for(var an,ap;an=al.next();){if(al.isPartiallySelectedSubtree()){if(ao(an)===false){e.stop=true;return}else{ap=al.getSubtreeIterator();V(ap,ao,e);ap.detach(true);if(e.stop){return}}}else{am=b.createIterator(an);while((aq=am.next())){if(ao(aq)===false){e.stop=true;return}}}}}function n(al){var e;while(al.next()){if(al.isPartiallySelectedSubtree()){e=al.getSubtreeIterator();n(e);e.detach(true)}else{al.remove()}}}function Q(al){for(var am,an=m(al.range).createDocumentFragment(),e;am=al.next();){if(al.isPartiallySelectedSubtree()){am=am.cloneNode(false);e=al.getSubtreeIterator();am.appendChild(Q(e));e.detach(true)}else{al.remove()}if(am.nodeType==10){throw new T("HIERARCHY_REQUEST_ERR")}an.appendChild(am)}return an}function p(am,e,an){var ap=!!(e&&e.length),ao;var aq=!!an;if(ap){ao=new RegExp("^("+e.join("|")+")$")}var al=[];V(new g(am,false),function(ar){if((!ap||ao.test(ar.nodeType))&&(!aq||an(ar))){al.push(ar)}});return al}function z(e){var al=(typeof e.getName=="undefined")?"Range":e.getName();return"["+al+"("+b.inspectNode(e.startContainer)+":"+e.startOffset+", "+b.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(am,al){this.range=am;this.clonePartiallySelectedTextNodes=al;if(!am.collapsed){this.sc=am.startContainer;this.so=am.startOffset;this.ec=am.endContainer;this.eo=am.endOffset;var e=am.commonAncestorContainer;if(this.sc===this.ec&&b.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===e&&!b.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:b.getClosestAncestorIn(this.sc,e,true);this._last=(this.ec===e&&!b.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:b.getClosestAncestorIn(this.ec,e,true)}}}g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var e=this._current=this._next;if(e){this._next=(e!==this._last)?e.nextSibling:null;if(b.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var al=this._current,am,e;if(b.isCharacterDataNode(al)&&(al===this.sc||al===this.ec)){am=(al===this.sc)?this.so:0;e=(al===this.ec)?this.eo:al.length;if(am!=e){al.deleteData(am,e-am)}}else{if(al.parentNode){al.parentNode.removeChild(al)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return x(e,this.range)},getSubtreeIterator:function(){var al;if(this.isSingleCharacterDataNode){al=this.range.cloneRange();al.collapse()}else{al=new aj(m(this.range));var ap=this._current;var an=ap,e=0,ao=ap,am=b.getNodeLength(ap);if(b.isAncestorOf(ap,this.sc,true)){an=this.sc;e=this.so}if(b.isAncestorOf(ap,this.ec,true)){ao=this.ec;am=this.eo}D(al,an,e,ao,am)}return new g(al,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function O(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}O.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};O.prototype.toString=function(){return this.message};function w(al,e,am){this.nodes=p(al,e,am);this._next=this.nodes[0];this._position=0}w.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ae=[1,3,4,5,7,8,10];var ac=[2,9,11];var B=[5,6,10,12];var M=[1,3,4,5,7,8,10,11];var F=[1,3,4,5,7,8];function Y(e){return function(am,ao){var al,an=ao?am:am.parentNode;while(an){al=an.nodeType;if(b.arrayContains(e,al)){return an}an=an.parentNode}return null}}var t=b.getRootContainer;var I=Y([9,11]);var K=Y(B);var c=Y([6,10,12]);function r(al,e){if(c(al,e)){throw new O("INVALID_NODE_TYPE_ERR")}}function C(e){if(!e.startContainer){throw new T("INVALID_STATE_ERR")}}function U(e,al){if(!b.arrayContains(al,e.nodeType)){throw new O("INVALID_NODE_TYPE_ERR")}}function ad(e,al){if(al<0||al>(b.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new T("INDEX_SIZE_ERR")}}function d(al,e){if(I(al,true)!==I(e,true)){throw new T("WRONG_DOCUMENT_ERR")}}function aa(e){if(K(e,true)){throw new T("NO_MODIFICATION_ALLOWED_ERR")}}function ah(al,e){if(!al){throw new T(e)}}function o(e){return !b.arrayContains(ac,e.nodeType)&&!I(e,true)}function ak(e,al){return al<=(b.isCharacterDataNode(e)?e.length:e.childNodes.length)}function h(e){C(e);if(o(e.startContainer)||o(e.endContainer)||!ak(e.startContainer,e.startOffset)||!ak(e.endContainer,e.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var a=document.createElement("style");var P=false;try{a.innerHTML="<b>x</b>";P=(a.firstChild.nodeType==3)}catch(ag){}i.features.htmlParsingConforms=P;var R=P?function(am){var al=this.startContainer;var an=b.getDocument(al);if(!al){throw new T("INVALID_STATE_ERR")}var e=null;if(al.nodeType==1){e=al}else{if(b.isCharacterDataNode(al)){e=b.parentElement(al)}}if(e===null||(e.nodeName=="HTML"&&b.isHtmlNamespace(b.getDocument(e).documentElement)&&b.isHtmlNamespace(e))){e=an.createElement("body")}else{e=e.cloneNode(false)}e.innerHTML=am;return b.fragmentFromNodeChildren(e)}:function(al){C(this);var am=m(this);var e=am.createElement("body");e.innerHTML=al;return b.fragmentFromNodeChildren(e)};var L=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var l=0,y=1,af=2,Z=3;var s=0,v=1,J=2,k=3;function ab(){}ab.prototype={attachListener:function(e,al){this._listeners[e].push(al)},compareBoundaryPoints:function(ap,am){h(this);d(this.startContainer,am.startContainer);var ar,al,aq,e;var ao=(ap==Z||ap==l)?"start":"end";var an=(ap==y||ap==l)?"start":"end";ar=this[ao+"Container"];al=this[ao+"Offset"];aq=am[an+"Container"];e=am[an+"Offset"];return b.comparePoints(ar,al,aq,e)},insertNode:function(al){h(this);U(al,M);aa(this.startContainer);if(b.isAncestorOf(al,this.startContainer,true)){throw new T("HIERARCHY_REQUEST_ERR")}var e=j(al,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){h(this);var am,al;if(this.collapsed){return m(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&b.isCharacterDataNode(this.startContainer)){am=this.startContainer.cloneNode(true);am.data=am.data.slice(this.startOffset,this.endOffset);al=m(this).createDocumentFragment();al.appendChild(am);return al}else{var e=new g(this,true);am=H(e);e.detach()}return am}},canSurroundContents:function(){h(this);aa(this.startContainer);aa(this.endContainer);var e=new g(this,true);var al=(e._first&&(x(e._first,this))||(e._last&&x(e._last,this)));e.detach();return !al},surroundContents:function(al){U(al,F);if(!this.canSurroundContents()){throw new O("BAD_BOUNDARYPOINTS_ERR")}var e=this.extractContents();if(al.hasChildNodes()){while(al.lastChild){al.removeChild(al.lastChild)}}j(al,this.startContainer,this.startOffset);al.appendChild(e);this.selectNode(al)},cloneRange:function(){h(this);var e=new aj(m(this));var al=L.length,am;while(al--){am=L[al];e[am]=this[am]}return e},toString:function(){h(this);var al=this.startContainer;if(al===this.endContainer&&b.isCharacterDataNode(al)){return(al.nodeType==3||al.nodeType==4)?al.data.slice(this.startOffset,this.endOffset):""}else{var am=[],e=new g(this,true);V(e,function(an){if(an.nodeType==3||an.nodeType==4){am.push(an.data)}});e.detach();return am.join("")}},compareNode:function(am){h(this);var al=am.parentNode;var ao=b.getNodeIndex(am);if(!al){throw new T("NOT_FOUND_ERR")}var an=this.comparePoint(al,ao),e=this.comparePoint(al,ao+1);if(an<0){return(e>0)?J:s}else{return(e>0)?v:k}},comparePoint:function(e,al){h(this);ah(e,"HIERARCHY_REQUEST_ERR");d(e,this.startContainer);if(b.comparePoints(e,al,this.startContainer,this.startOffset)<0){return -1}else{if(b.comparePoints(e,al,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:R,toHtml:function(){h(this);var e=m(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(an,e){h(this);ah(an,"NOT_FOUND_ERR");if(b.getDocument(an)!==m(this)){return false}var am=an.parentNode,ap=b.getNodeIndex(an);ah(am,"NOT_FOUND_ERR");var ao=b.comparePoints(am,ap,this.endContainer,this.endOffset),al=b.comparePoints(am,ap+1,this.startContainer,this.startOffset);return e?ao<=0&&al>=0:ao<0&&al>0},isPointInRange:function(e,al){h(this);ah(e,"HIERARCHY_REQUEST_ERR");d(e,this.startContainer);return(b.comparePoints(e,al,this.startContainer,this.startOffset)>=0)&&(b.comparePoints(e,al,this.endContainer,this.endOffset)<=0)},intersectsRange:function(al,e){h(this);if(m(al)!=m(this)){throw new T("WRONG_DOCUMENT_ERR")}var an=b.comparePoints(this.startContainer,this.startOffset,al.endContainer,al.endOffset),am=b.comparePoints(this.endContainer,this.endOffset,al.startContainer,al.startOffset);return e?an<=0&&am>=0:an<0&&am>0},intersection:function(e){if(this.intersectsRange(e)){var an=b.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),al=b.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var am=this.cloneRange();if(an==-1){am.setStart(e.startContainer,e.startOffset)}if(al==1){am.setEnd(e.endContainer,e.endOffset)}return am}return null},union:function(e){if(this.intersectsRange(e,true)){var al=this.cloneRange();if(b.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){al.setStart(e.startContainer,e.startOffset)}if(b.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){al.setEnd(e.endContainer,e.endOffset)}return al}else{throw new O("Ranges do not intersect")}},containsNode:function(al,e){if(e){return this.intersectsNode(al,false)}else{return this.compareNode(al)==k}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,b.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(an){var ao=this.cloneRange();ao.selectNode(an);var am=ao.getNodes([3]);if(am.length>0){ao.setStart(am[0],0);var e=am.pop();ao.setEnd(e,e.length);var al=this.containsRange(ao);ao.detach();return al}else{return this.containsNodeContents(an)}},createNodeIterator:function(e,al){h(this);return new w(this,e,al)},getNodes:function(e,al){h(this);return p(this,e,al)},getDocument:function(){return m(this)},collapseBefore:function(e){C(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){C(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return aj.rangesEqual(this,e)},inspect:function(){return z(this)}};function S(e){e.START_TO_START=l;e.START_TO_END=y;e.END_TO_END=af;e.END_TO_START=Z;e.NODE_BEFORE=s;e.NODE_AFTER=v;e.NODE_BEFORE_AND_AFTER=J;e.NODE_INSIDE=k}function G(e){S(e);S(e.prototype)}function q(e,al){return function(){h(this);var ar=this.startContainer,aq=this.startOffset,am=this.commonAncestorContainer;var ao=new g(this,true);var ap,at;if(ar!==am){ap=b.getClosestAncestorIn(ar,am,true);at=W(ap);ar=at.node;aq=at.offset}V(ao,aa);ao.reset();var an=e(ao);ao.detach();al(this,ar,aq,ar,aq);return an}}function X(an,aq,e){function ap(at,ar){return function(au){C(this);U(au,ae);U(t(au),ac);var av=(at?A:W)(au);(ar?am:ao)(this,av.node,av.offset)}}function am(at,av,aw){var au=at.endContainer,ar=at.endOffset;if(av!==at.startContainer||aw!==at.startOffset){if(t(av)!=t(au)||b.comparePoints(av,aw,au,ar)==1){au=av;ar=aw}aq(at,av,aw,au,ar)}}function ao(ar,at,aw){var av=ar.startContainer,au=ar.startOffset;if(at!==ar.endContainer||aw!==ar.endOffset){if(t(at)!=t(av)||b.comparePoints(at,aw,av,au)==-1){av=at;au=aw}aq(ar,av,au,at,aw)}}function al(ar,at,au){if(at!==ar.startContainer||au!==ar.startOffset||at!==ar.endContainer||au!==ar.endOffset){aq(ar,at,au,at,au)}}an.prototype=new ab();i.util.extend(an.prototype,{setStart:function(ar,at){C(this);r(ar,true);ad(ar,at);am(this,ar,at)},setEnd:function(ar,at){C(this);r(ar,true);ad(ar,at);ao(this,ar,at)},setStartBefore:ap(true,true),setStartAfter:ap(false,true),setEndBefore:ap(true,false),setEndAfter:ap(false,false),collapse:function(ar){h(this);if(ar){aq(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{aq(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(ar){C(this);r(ar,true);aq(this,ar,0,ar,b.getNodeLength(ar))},selectNode:function(at){C(this);r(at,false);U(at,ae);var au=A(at),ar=W(at);aq(this,au.node,au.offset,ar.node,ar.offset)},extractContents:q(Q,aq),deleteContents:q(n,aq),canSurroundContents:function(){h(this);aa(this.startContainer);aa(this.endContainer);var ar=new g(this,true);var at=(ar._first&&(x(ar._first,this))||(ar._last&&x(ar._last,this)));ar.detach();return !at},detach:function(){e(this)},splitBoundaries:function(){h(this);var aw=this.startContainer,av=this.startOffset,at=this.endContainer,ar=this.endOffset;var au=(aw===at);if(b.isCharacterDataNode(at)&&ar>0&&ar<at.length){b.splitDataNode(at,ar)}if(b.isCharacterDataNode(aw)&&av>0&&av<aw.length){aw=b.splitDataNode(aw,av);if(au){ar-=av;at=aw}else{if(at==aw.parentNode&&ar>=b.getNodeIndex(aw)){ar++}}av=0}aq(this,aw,av,at,ar)},normalizeBoundaries:function(){h(this);var az=this.startContainer,au=this.startOffset,ay=this.endContainer,ar=this.endOffset;var av=function(aC){var aB=aC.nextSibling;if(aB&&aB.nodeType==aC.nodeType){ay=aC;ar=aC.length;aC.appendData(aB.data);aB.parentNode.removeChild(aB)}};var aA=function(aD){var aC=aD.previousSibling;if(aC&&aC.nodeType==aD.nodeType){az=aD;var aB=aD.length;au=aC.length;aD.insertData(0,aC.data);aC.parentNode.removeChild(aC);if(az==ay){ar+=au;ay=az}else{if(ay==aD.parentNode){var aE=b.getNodeIndex(aD);if(ar==aE){ay=aD;ar=aB}else{if(ar>aE){ar--}}}}}};var ax=true;if(b.isCharacterDataNode(ay)){if(ay.length==ar){av(ay)}}else{if(ar>0){var aw=ay.childNodes[ar-1];if(aw&&b.isCharacterDataNode(aw)){av(aw)}}ax=!this.collapsed}if(ax){if(b.isCharacterDataNode(az)){if(au==0){aA(az)}}else{if(au<az.childNodes.length){var at=az.childNodes[au];if(at&&b.isCharacterDataNode(at)){aA(at)}}}}else{az=ay;au=ar}aq(this,az,au,ay,ar)},collapseToPoint:function(ar,at){C(this);r(ar,true);ad(ar,at);al(this,ar,at)}});G(an)}function N(e){e.collapsed=(e.startContainer===e.endContainer&&e.startOffset===e.endOffset);e.commonAncestorContainer=e.collapsed?e.startContainer:b.getCommonAncestor(e.startContainer,e.endContainer)}function D(am,ao,al,ap,an){var e=(am.startContainer!==ao||am.startOffset!==al);var aq=(am.endContainer!==ap||am.endOffset!==an);am.startContainer=ao;am.startOffset=al;am.endContainer=ap;am.endOffset=an;N(am);u(am,"boundarychange",{startMoved:e,endMoved:aq})}function ai(e){C(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;u(e,"detach",null);e._listeners=null}function aj(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};N(this)}X(aj,D,ai);i.rangePrototype=ab.prototype;aj.rangeProperties=L;aj.RangeIterator=g;aj.copyComparisonConstants=G;aj.createPrototypeRange=X;aj.inspect=z;aj.getRangeDocument=m;aj.rangesEqual=function(al,e){return al.startContainer===e.startContainer&&al.startOffset===e.startOffset&&al.endContainer===e.endContainer&&al.endOffset===e.endOffset};i.DomRange=aj;i.RangeException=O});rangy.createModule("WrappedRange",function(i,d){i.requireModules(["DomUtil","DomRange"]);var a;var h=i.dom;var b=h.DomPosition;var j=i.DomRange;function e(q){var o=q.parentElement();var m=q.duplicate();m.collapse(true);var p=m.parentElement();m=q.duplicate();m.collapse(false);var n=m.parentElement();var l=(p==n)?p:h.getCommonAncestor(p,n);return l==o?l:h.getCommonAncestor(o,l)}function c(l){return l.compareEndPoints("StartToEnd",l)==0}function f(z,w,n,s){var A=z.duplicate();A.collapse(n);var y=A.parentElement();if(!h.isAncestorOf(w,y,true)){y=w}if(!y.canHaveHTML){return new b(y.parentNode,h.getNodeIndex(y))}var m=h.getDocument(y).createElement("span");var x,u=n?"StartToStart":"StartToEnd";var v,q,l,o;do{y.insertBefore(m,m.previousSibling);A.moveToElementText(m)}while((x=A.compareEndPoints(u,z))>0&&m.previousSibling);o=m.nextSibling;if(x==-1&&o&&h.isCharacterDataNode(o)){A.setEndPoint(n?"EndToStart":"EndToEnd",z);var r;if(/[\r\n]/.test(o.data)){var t=A.duplicate();var p=t.text.replace(/\r\n/g,"\r").length;r=t.moveStart("character",p);while((x=t.compareEndPoints("StartToEnd",t))==-1){r++;t.moveStart("character",1)}}else{r=A.text.length}l=new b(o,r)}else{v=(s||!n)&&m.previousSibling;q=(s||n)&&m.nextSibling;if(q&&h.isCharacterDataNode(q)){l=new b(q,0)}else{if(v&&h.isCharacterDataNode(v)){l=new b(v,v.length)}else{l=new b(y,h.getNodeIndex(m))}}}m.parentNode.removeChild(m);return l}function k(l,n){var o,r,p=l.offset;var s=h.getDocument(l.node);var m,t,u=s.body.createTextRange();var q=h.isCharacterDataNode(l.node);if(q){o=l.node;r=o.parentNode}else{t=l.node.childNodes;o=(p<t.length)?t[p]:null;r=l.node}m=s.createElement("span");m.innerHTML="&#feff;";if(o){r.insertBefore(m,o)}else{r.appendChild(m)}u.moveToElementText(m);u.collapse(!n);r.removeChild(m);if(q){u[n?"moveStart":"moveEnd"]("character",p)}return u}if(i.features.implementsDomRange&&(!i.features.implementsTextRange||!i.config.preferTextRange)){(function(){var n;var s=j.rangeProperties;var v;function l(w){var x=s.length,y;while(x--){y=s[x];w[y]=w.nativeRange[y]}}function o(y,A,x,B,z){var w=(y.startContainer!==A||y.startOffset!=x);var C=(y.endContainer!==B||y.endOffset!=z);if(w||C){y.setEnd(B,z);y.setStart(A,x)}}function t(w){w.nativeRange.detach();w.detached=true;var x=s.length,y;while(x--){y=s[x];w[y]=null}}var m;a=function(w){if(!w){throw new Error("Range must be specified")}this.nativeRange=w;l(this)};j.createPrototypeRange(a,o,t);n=a.prototype;n.selectNode=function(w){this.nativeRange.selectNode(w);l(this)};n.deleteContents=function(){this.nativeRange.deleteContents();l(this)};n.extractContents=function(){var w=this.nativeRange.extractContents();l(this);return w};n.cloneContents=function(){return this.nativeRange.cloneContents()};n.surroundContents=function(w){this.nativeRange.surroundContents(w);l(this)};n.collapse=function(w){this.nativeRange.collapse(w);l(this)};n.cloneRange=function(){return new a(this.nativeRange.cloneRange())};n.refresh=function(){l(this)};n.toString=function(){return this.nativeRange.toString()};var r=document.createTextNode("test");h.getBody(document).appendChild(r);var p=document.createRange();p.setStart(r,0);p.setEnd(r,0);try{p.setStart(r,1);v=true;n.setStart=function(w,x){this.nativeRange.setStart(w,x);l(this)};n.setEnd=function(w,x){this.nativeRange.setEnd(w,x);l(this)};m=function(w){return function(x){this.nativeRange[w](x);l(this)}}}catch(q){v=false;n.setStart=function(x,y){try{this.nativeRange.setStart(x,y)}catch(w){this.nativeRange.setEnd(x,y);this.nativeRange.setStart(x,y)}l(this)};n.setEnd=function(x,y){try{this.nativeRange.setEnd(x,y)}catch(w){this.nativeRange.setStart(x,y);this.nativeRange.setEnd(x,y)}l(this)};m=function(w,x){return function(z){try{this.nativeRange[w](z)}catch(y){this.nativeRange[x](z);this.nativeRange[w](z)}l(this)}}}n.setStartBefore=m("setStartBefore","setEndBefore");n.setStartAfter=m("setStartAfter","setEndAfter");n.setEndBefore=m("setEndBefore","setStartBefore");n.setEndAfter=m("setEndAfter","setStartAfter");p.selectNodeContents(r);if(p.startContainer==r&&p.endContainer==r&&p.startOffset==0&&p.endOffset==r.length){n.selectNodeContents=function(w){this.nativeRange.selectNodeContents(w);l(this)}}else{n.selectNodeContents=function(w){this.setStart(w,0);this.setEnd(w,j.getEndOffset(w))}}p.selectNodeContents(r);p.setEnd(r,3);var u=document.createRange();u.selectNodeContents(r);u.setEnd(r,4);u.setStart(r,2);if(p.compareBoundaryPoints(p.START_TO_END,u)==-1&p.compareBoundaryPoints(p.END_TO_START,u)==1){n.compareBoundaryPoints=function(x,w){w=w.nativeRange||w;if(x==w.START_TO_END){x=w.END_TO_START}else{if(x==w.END_TO_START){x=w.START_TO_END}}return this.nativeRange.compareBoundaryPoints(x,w)}}else{n.compareBoundaryPoints=function(x,w){return this.nativeRange.compareBoundaryPoints(x,w.nativeRange||w)}}if(i.util.isHostMethod(p,"createContextualFragment")){n.createContextualFragment=function(w){return this.nativeRange.createContextualFragment(w)}}h.getBody(document).removeChild(r);p.detach();u.detach()})();i.createNativeRange=function(l){l=l||document;return l.createRange()}}else{if(i.features.implementsTextRange){a=function(l){this.textRange=l;this.refresh()};a.prototype=new j(document);a.prototype.refresh=function(){var n,l;var m=e(this.textRange);if(c(this.textRange)){l=n=f(this.textRange,m,true,true)}else{n=f(this.textRange,m,true,false);l=f(this.textRange,m,false,false)}this.setStart(n.node,n.offset);this.setEnd(l.node,l.offset)};j.copyComparisonConstants(a);var g=(function(){return this})();if(typeof g.Range=="undefined"){g.Range=a}i.createNativeRange=function(l){l=l||document;return l.body.createTextRange()}}}if(i.features.implementsTextRange){a.rangeToTextRange=function(l){if(l.collapsed){var o=k(new b(l.startContainer,l.startOffset),true);return o}else{var p=k(new b(l.startContainer,l.startOffset),true);var n=k(new b(l.endContainer,l.endOffset),false);var m=h.getDocument(l.startContainer).body.createTextRange();m.setEndPoint("StartToStart",p);m.setEndPoint("EndToEnd",n);return m}}}a.prototype.getName=function(){return"WrappedRange"};i.WrappedRange=a;i.createRange=function(l){l=l||document;return new a(i.createNativeRange(l))};i.createRangyRange=function(l){l=l||document;return new j(l)};i.createIframeRange=function(l){return i.createRange(h.getIframeDocument(l))};i.createIframeRangyRange=function(l){return i.createRangyRange(h.getIframeDocument(l))};i.addCreateMissingNativeApiListener(function(m){var l=m.document;if(typeof l.createRange=="undefined"){l.createRange=function(){return i.createRange(this)}}l=m=null})});rangy.createModule("WrappedSelection",function(g,d){g.requireModules(["DomUtil","DomRange","WrappedRange"]);g.config.checkSelectionRanges=true;var D="boolean",T="_rangySelection",c=g.dom,l=g.util,Q=g.DomRange,e=g.WrappedRange,N=g.DOMException,y=c.DomPosition,w,n,U="Control";function m(W){return(W||window).getSelection()}function q(W){return(W||window).document.selection}var S=g.util.isHostMethod(window,"getSelection"),M=g.util.isHostObject(document,"selection");var u=M&&(!S||g.config.preferTextRange);if(u){w=q;g.isSelectionValid=function(X){var Y=(X||window).document,W=Y.selection;return(W.type!="None"||c.getDocument(W.createRange().parentElement())==Y)}}else{if(S){w=m;g.isSelectionValid=function(){return true}}else{d.fail("Neither document.selection or window.getSelection() detected.")}}g.getNativeSelection=w;var L=w();var B=g.createNativeRange(document);var C=c.getBody(document);var J=l.areHostObjects(L,["anchorNode","focusNode"]&&l.areHostProperties(L,["anchorOffset","focusOffset"]));g.features.selectionHasAnchorAndFocus=J;var p=l.isHostMethod(L,"extend");g.features.selectionHasExtend=p;var V=(typeof L.rangeCount=="number");g.features.selectionHasRangeCount=V;var P=false;var O=true;if(l.areHostMethods(L,["addRange","getRangeAt","removeAllRanges"])&&typeof L.rangeCount=="number"&&g.features.implementsDomRange){(function(){var Y=document.createElement("iframe");C.appendChild(Y);var ac=c.getIframeDocument(Y);ac.open();ac.write("<html><head></head><body>12</body></html>");ac.close();var aa=c.getIframeWindow(Y).getSelection();var ad=ac.documentElement;var Z=ad.lastChild,ab=Z.firstChild;var X=ac.createRange();X.setStart(ab,1);X.collapse(true);aa.addRange(X);O=(aa.rangeCount==1);aa.removeAllRanges();var W=X.cloneRange();X.setStart(ab,0);W.setEnd(ab,2);aa.addRange(X);aa.addRange(W);P=(aa.rangeCount==2);X.detach();W.detach();C.removeChild(Y)})()}g.features.selectionSupportsMultipleRanges=P;g.features.collapsedNonEditableSelectionsSupported=O;var f=false,j;if(C&&l.isHostMethod(C,"createControlRange")){j=C.createControlRange();if(l.areHostProperties(j,["item","add"])){f=true}}g.features.implementsControlRange=f;if(J){n=function(W){return W.anchorNode===W.focusNode&&W.anchorOffset===W.focusOffset}}else{n=function(W){return W.rangeCount?W.getRangeAt(W.rangeCount-1).collapsed:false}}function b(Z,X,W){var Y=W?"end":"start",aa=W?"start":"end";Z.anchorNode=X[Y+"Container"];Z.anchorOffset=X[Y+"Offset"];Z.focusNode=X[aa+"Container"];Z.focusOffset=X[aa+"Offset"]}function v(X){var W=X.nativeSelection;X.anchorNode=W.anchorNode;X.anchorOffset=W.anchorOffset;X.focusNode=W.focusNode;X.focusOffset=W.focusOffset}function G(W){W.anchorNode=W.focusNode=null;W.anchorOffset=W.focusOffset=0;W.rangeCount=0;W.isCollapsed=true;W._ranges.length=0}function I(W){var X;if(W instanceof Q){X=W._selectionNativeRange;if(!X){X=g.createNativeRange(c.getDocument(W.startContainer));X.setEnd(W.endContainer,W.endOffset);X.setStart(W.startContainer,W.startOffset);W._selectionNativeRange=X;W.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(W instanceof e){X=W.nativeRange}else{if(g.features.implementsDomRange&&(W instanceof c.getWindow(W.startContainer).Range)){X=W}}}return X}function k(Y){if(!Y.length||Y[0].nodeType!=1){return false}for(var X=1,W=Y.length;X<W;++X){if(!c.isAncestorOf(Y[0],Y[X])){return false}}return true}function K(X){var W=X.getNodes();if(!k(W)){throw new Error("getSingleElementFromRange: range "+X.inspect()+" did not consist of a single element")}return W[0]}function F(W){return !!W&&typeof W.text!="undefined"}function H(Y,X){var W=new e(X);Y._ranges=[W];b(Y,W,false);Y.rangeCount=1;Y.isCollapsed=W.collapsed}function t(Z){Z._ranges.length=0;if(Z.docSelection.type=="None"){G(Z)}else{var Y=Z.docSelection.createRange();if(F(Y)){H(Z,Y)}else{Z.rangeCount=Y.length;var W,aa=c.getDocument(Y.item(0));for(var X=0;X<Z.rangeCount;++X){W=g.createRange(aa);W.selectNode(Y.item(X));Z._ranges.push(W)}Z.isCollapsed=Z.rangeCount==1&&Z._ranges[0].collapsed;b(Z,Z._ranges[Z.rangeCount-1],false)}}}function x(X,aa){var Y=X.docSelection.createRange();var W=K(aa);var ae=c.getDocument(Y.item(0));var ab=c.getBody(ae).createControlRange();for(var Z=0,ac=Y.length;Z<ac;++Z){ab.add(Y.item(Z))}try{ab.add(W)}catch(ad){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}ab.select();t(X)}var o;if(l.isHostMethod(L,"getRangeAt")){o=function(Y,W){try{return Y.getRangeAt(W)}catch(X){return null}}}else{if(J){o=function(X){var Y=c.getDocument(X.anchorNode);var W=g.createRange(Y);W.setStart(X.anchorNode,X.anchorOffset);W.setEnd(X.focusNode,X.focusOffset);if(W.collapsed!==this.isCollapsed){W.setStart(X.focusNode,X.focusOffset);W.setEnd(X.anchorNode,X.anchorOffset)}return W}}}function A(W,Y,X){this.nativeSelection=W;this.docSelection=Y;this._ranges=[];this.win=X;this.refresh()}g.getSelection=function(Y){Y=Y||window;var X=Y[T];var W=w(Y),Z=M?q(Y):null;if(X){X.nativeSelection=W;X.docSelection=Z;X.refresh(Y)}else{X=new A(W,Z,Y);Y[T]=X}return X};g.getIframeSelection=function(W){return g.getSelection(c.getIframeWindow(W))};var a=A.prototype;function i(ab,W){var ac=c.getDocument(W[0].startContainer);var Z=c.getBody(ac).createControlRange();for(var Y=0,aa;Y<rangeCount;++Y){aa=K(W[Y]);try{Z.add(aa)}catch(X){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}Z.select();t(ab)}if(!u&&J&&l.areHostMethods(L,["removeAllRanges","addRange"])){a.removeAllRanges=function(){this.nativeSelection.removeAllRanges();G(this)};var h=function(Y,W){var Z=Q.getRangeDocument(W);var X=g.createRange(Z);X.collapseToPoint(W.endContainer,W.endOffset);Y.nativeSelection.addRange(I(X));Y.nativeSelection.extend(W.startContainer,W.startOffset);Y.refresh()};if(V){a.addRange=function(X,W){if(f&&M&&this.docSelection.type==U){x(this,X)}else{if(W&&p){h(this,X)}else{var Y;if(P){Y=this.rangeCount}else{this.removeAllRanges();Y=0}this.nativeSelection.addRange(I(X));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==Y+1){if(g.config.checkSelectionRanges){var Z=o(this.nativeSelection,this.rangeCount-1);if(Z&&!Q.rangesEqual(Z,X)){X=new e(Z)}}this._ranges[this.rangeCount-1]=X;b(this,X,r(this.nativeSelection));this.isCollapsed=n(this)}else{this.refresh()}}}}}else{a.addRange=function(X,W){if(W&&p){h(this,X)}else{this.nativeSelection.addRange(I(X));this.refresh()}}}a.setRanges=function(X){if(f&&X.length>1){i(this,X)}else{this.removeAllRanges();for(var Y=0,W=X.length;Y<W;++Y){this.addRange(X[Y])}}}}else{if(l.isHostMethod(L,"empty")&&l.isHostMethod(B,"select")&&f&&u){a.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var Z;if(this.anchorNode){Z=c.getDocument(this.anchorNode)}else{if(this.docSelection.type==U){var X=this.docSelection.createRange();if(X.length){Z=c.getDocument(X.item(0)).body.createTextRange()}}}if(Z){var Y=Z.body.createTextRange();Y.select();this.docSelection.empty()}}}catch(W){}G(this)};a.addRange=function(W){if(this.docSelection.type==U){x(this,W)}else{e.rangeToTextRange(W).select();this._ranges[0]=W;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;b(this,W,false)}};a.setRanges=function(W){this.removeAllRanges();var X=W.length;if(X>1){i(this,W)}else{if(X){this.addRange(W[0])}}}}else{d.fail("No means of selecting a Range or TextRange was found");return false}}a.getRangeAt=function(W){if(W<0||W>=this.rangeCount){throw new N("INDEX_SIZE_ERR")}else{return this._ranges[W]}};var E;if(u){E=function(X){var W;if(g.isSelectionValid(X.win)){W=X.docSelection.createRange()}else{W=c.getBody(X.win.document).createTextRange();W.collapse(true)}if(X.docSelection.type==U){t(X)}else{if(F(W)){H(X,W)}else{G(X)}}}}else{if(l.isHostMethod(L,"getRangeAt")&&typeof L.rangeCount=="number"){E=function(Y){if(f&&M&&Y.docSelection.type==U){t(Y)}else{Y._ranges.length=Y.rangeCount=Y.nativeSelection.rangeCount;if(Y.rangeCount){for(var X=0,W=Y.rangeCount;X<W;++X){Y._ranges[X]=new g.WrappedRange(Y.nativeSelection.getRangeAt(X))}b(Y,Y._ranges[Y.rangeCount-1],r(Y.nativeSelection));Y.isCollapsed=n(Y)}else{G(Y)}}}}else{if(J&&typeof L.isCollapsed==D&&typeof B.collapsed==D&&g.features.implementsDomRange){E=function(Y){var W,X=Y.nativeSelection;if(X.anchorNode){W=o(X,0);Y._ranges=[W];Y.rangeCount=1;v(Y);Y.isCollapsed=n(Y)}else{G(Y)}}}else{d.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}a.refresh=function(X){var W=X?this._ranges.slice(0):null;E(this);if(X){var Y=W.length;if(Y!=this._ranges.length){return false}while(Y--){if(!Q.rangesEqual(W[Y],this._ranges[Y])){return false}}return true}};var z=function(aa,Y){var X=aa.getAllRanges(),ab=false;aa.removeAllRanges();for(var Z=0,W=X.length;Z<W;++Z){if(ab||Y!==X[Z]){aa.addRange(X[Z])}else{ab=true}}if(!aa.rangeCount){G(aa)}};if(f){a.removeRange=function(aa){if(this.docSelection.type==U){var Y=this.docSelection.createRange();var W=K(aa);var ae=c.getDocument(Y.item(0));var ac=c.getBody(ae).createControlRange();var X,ad=false;for(var Z=0,ab=Y.length;Z<ab;++Z){X=Y.item(Z);if(X!==W||ad){ac.add(Y.item(Z))}else{ad=true}}ac.select();t(this)}else{z(this,aa)}}}else{a.removeRange=function(W){z(this,W)}}var r;if(!u&&J&&g.features.implementsDomRange){r=function(X){var W=false;if(X.anchorNode){W=(c.comparePoints(X.anchorNode,X.anchorOffset,X.focusNode,X.focusOffset)==1)}return W};a.isBackwards=function(){return r(this)}}else{r=a.isBackwards=function(){return false}}a.toString=function(){var Y=[];for(var X=0,W=this.rangeCount;X<W;++X){Y[X]=""+this._ranges[X]}return Y.join("")};function R(X,W){if(X.anchorNode&&(c.getDocument(X.anchorNode)!==c.getDocument(W))){throw new N("WRONG_DOCUMENT_ERR")}}a.collapse=function(X,Y){R(this,X);var W=g.createRange(c.getDocument(X));W.collapseToPoint(X,Y);this.removeAllRanges();this.addRange(W);this.isCollapsed=true};a.collapseToStart=function(){if(this.rangeCount){var W=this._ranges[0];this.collapse(W.startContainer,W.startOffset)}else{throw new N("INVALID_STATE_ERR")}};a.collapseToEnd=function(){if(this.rangeCount){var W=this._ranges[this.rangeCount-1];this.collapse(W.endContainer,W.endOffset)}else{throw new N("INVALID_STATE_ERR")}};a.selectAllChildren=function(X){R(this,X);var W=g.createRange(c.getDocument(X));W.selectNodeContents(X);this.removeAllRanges();this.addRange(W)};a.deleteFromDocument=function(){if(f&&M&&this.docSelection.type==U){var aa=this.docSelection.createRange();var Z;while(aa.length){Z=aa.item(0);aa.remove(Z);Z.parentNode.removeChild(Z)}this.refresh()}else{if(this.rangeCount){var X=this.getAllRanges();this.removeAllRanges();for(var Y=0,W=X.length;Y<W;++Y){X[Y].deleteContents()}this.addRange(X[W-1])}}};a.getAllRanges=function(){return this._ranges.slice(0)};a.setSingleRange=function(W){this.setRanges([W])};a.containsNode=function(Z,X){for(var Y=0,W=this._ranges.length;Y<W;++Y){if(this._ranges[Y].containsNode(Z,X)){return true}}return false};a.toHtml=function(){var Z="";if(this.rangeCount){var X=Q.getRangeDocument(this._ranges[0]).createElement("div");for(var Y=0,W=this._ranges.length;Y<W;++Y){X.appendChild(this._ranges[Y].cloneContents())}Z=X.innerHTML}return Z};function s(ac){var ab=[];var Z=new y(ac.anchorNode,ac.anchorOffset);var X=new y(ac.focusNode,ac.focusOffset);var Y=(typeof ac.getName=="function")?ac.getName():"Selection";if(typeof ac.rangeCount!="undefined"){for(var aa=0,W=ac.rangeCount;aa<W;++aa){ab[aa]=Q.inspect(ac.getRangeAt(aa))}}return"["+Y+"(Ranges: "+ab.join(", ")+")(anchor: "+Z.inspect()+", focus: "+X.inspect()+"]"}a.getName=function(){return"WrappedSelection"};a.inspect=function(){return s(this)};a.detach=function(){this.win[T]=null;this.win=this.anchorNode=this.focusNode=null};A.inspect=s;g.Selection=A;g.selectionPrototype=a;g.addCreateMissingNativeApiListener(function(W){if(typeof W.getSelection=="undefined"){W.getSelection=function(){return g.getSelection(this)}}W=null})});rangy.createModule("CssClassApplier",function(g,e){g.requireModules(["WrappedSelection","WrappedRange"]);var b=g.dom;var z="span";function a(K){return K.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function D(L,K){return L.className&&new RegExp("(?:^|\\s)"+K+"(?:\\s|$)").test(L.className)}function r(L,K){if(L.className){if(!D(L,K)){L.className+=" "+K}}else{L.className=K}}var m=(function(){function K(L,N,M){return(N&&M)?" ":""}return function(M,L){if(M.className){M.className=M.className.replace(new RegExp("(?:^|\\s)"+L+"(?:\\s|$)"),K)}}})();function v(K){return K.split(/\s+/).sort().join(" ")}function s(K){return v(K.className)}function l(L,K){return s(L)==s(K)}function u(L){var K=L.parentNode;while(L.hasChildNodes()){K.insertBefore(L.firstChild,L)}K.removeChild(L)}function w(K,O){var L=K.cloneRange();L.selectNodeContents(O);var M=L.intersection(K);var N=M?M.toString():"";L.detach();return N!=""}function B(K){return K.getNodes([3],function(L){return w(K,L)})}function G(Q,O){if(Q.attributes.length!=O.attributes.length){return false}for(var P=0,K=Q.attributes.length,N,L,M;P<K;++P){N=Q.attributes[P];M=N.name;if(M!="class"){L=O.attributes.getNamedItem(M);if(N.specified!=L.specified){return false}if(N.specified&&N.nodeValue!==L.nodeValue){return false}}}return true}function H(O,N){for(var M=0,K=O.attributes.length,L;M<K;++M){L=O.attributes[M].name;if(!(N&&b.arrayContains(N,L))&&O.attributes[M].specified&&L!="class"){return true}}return false}function J(L,K){for(var M in K){if(K.hasOwnProperty(M)&&L[M]!==K[M]){return false}}return true}var n;if(typeof window.getComputedStyle!="undefined"){n=function(K,L){return b.getWindow(K).getComputedStyle(K,null)[L]}}else{if(typeof document.documentElement.currentStyle!="undefined"){n=function(K,L){return K.currentStyle[L]}}else{e.fail("No means of obtaining computed style properties found")}}var p;(function(){var K=document.createElement("div");if(typeof K.isContentEditable=="boolean"){p=function(L){return L&&L.nodeType==1&&L.isContentEditable}}else{p=function(L){if(!L||L.nodeType!=1||L.contentEditable=="false"){return false}return L.contentEditable=="true"||p(L.parentNode)}}})();function d(L){var K;return L&&L.nodeType==1&&(((K=L.parentNode)&&K.nodeType==9&&K.designMode=="on")||(p(L)&&!p(L.parentNode)))}function c(K){return(p(K)||(K.nodeType!=1&&p(K.parentNode)))&&!d(K)}var F=/^inline(-block|-table)?$/i;function f(K){return K&&K.nodeType==1&&!F.test(n(K,"display"))}var i=/[^\r\n\t\f \u200B]/;function C(K){if(K.data.length==0){return true}if(i.test(K.data)){return false}var L=n(K.parentNode,"whiteSpace");switch(L){case"pre":case"pre-wrap":case"-moz-pre-wrap":return false;case"pre-line":if(/[\r\n]/.test(K.data)){return false}}return f(K.previousSibling)||f(K.nextSibling)}function A(K,L){if(b.isCharacterDataNode(K)){if(L==0){return !!K.previousSibling}else{if(L==K.length){return !!K.nextSibling}else{return true}}}return L>0&&L<K.childNodes.length}function E(P,M,O,Q){var L;var K=(O==0);if(b.isAncestorOf(M,P)){return P}if(b.isCharacterDataNode(M)){if(O==0){O=b.getNodeIndex(M);M=M.parentNode}else{if(O==M.length){O=b.getNodeIndex(M)+1;M=M.parentNode}else{throw e.createError("splitNodeAt should not be called with offset in the middle of a data node ("+O+" in "+M.data)}}}if(A(M,O)){if(!L){L=M.cloneNode(false);if(L.id){L.removeAttribute("id")}var R;while((R=M.childNodes[O])){L.appendChild(R)}b.insertAfter(L,M)}return(M==P)?L:E(P,L.parentNode,b.getNodeIndex(L),Q)}else{if(P!=M){L=M.parentNode;var N=b.getNodeIndex(M);if(!K){N++}return E(P,L,N,Q)}}return P}function I(L,K){return L.tagName==K.tagName&&l(L,K)&&G(L,K)}function o(K){var L=K?"nextSibling":"previousSibling";return function(P,M){var N=P.parentNode;var O=P[L];if(O){if(O&&O.nodeType==3){return O}}else{if(M){O=N[L];if(O&&O.nodeType==1&&I(N,O)){return O[K?"firstChild":"lastChild"]}}}return null}}var q=o(false),k=o(true);function t(K){this.isElementMerge=(K.nodeType==1);this.firstTextNode=this.isElementMerge?K.lastChild:K;this.textNodes=[this.firstTextNode]}t.prototype={doMerge:function(){var P=[],O,M,N;for(var L=0,K=this.textNodes.length;L<K;++L){O=this.textNodes[L];M=O.parentNode;P[L]=O.data;if(L){M.removeChild(O);if(!M.hasChildNodes()){M.parentNode.removeChild(M)}}}this.firstTextNode.data=N=P.join("");return N},getLength:function(){var L=this.textNodes.length,K=0;while(L--){K+=this.textNodes[L].length}return K},toString:function(){var M=[];for(var L=0,K=this.textNodes.length;L<K;++L){M[L]="'"+this.textNodes[L].data+"'"}return"[Merge("+M.join(",")+")]"}};var x=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"];var y={"class":"className"};function h(U,T,S){this.cssClass=U;var O,N,Q,P;var M=null;if(typeof T=="object"&&T!==null){S=T.tagNames;M=T.elementProperties;for(N=0;P=x[N++];){if(T.hasOwnProperty(P)){this[P]=T[P]}}O=T.normalize}else{O=T}this.normalize=(typeof O=="undefined")?true:O;this.attrExceptions=[];var L=document.createElement(this.elementTagName);this.elementProperties={};for(var K in M){if(M.hasOwnProperty(K)){if(y.hasOwnProperty(K)){K=y[K]}L[K]=M[K];this.elementProperties[K]=L[K];this.attrExceptions.push(K)}}this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?v(this.elementProperties.className+" "+U):U;this.applyToAnyTagName=false;var R=typeof S;if(R=="string"){if(S=="*"){this.applyToAnyTagName=true}else{this.tagNames=a(S.toLowerCase()).split(/\s*,\s*/)}}else{if(R=="object"&&typeof S.length=="number"){this.tagNames=[];for(N=0,Q=S.length;N<Q;++N){if(S[N]=="*"){this.applyToAnyTagName=true}else{this.tagNames.push(S[N].toLowerCase())}}}else{this.tagNames=[this.elementTagName]}}}h.prototype={elementTagName:z,elementProperties:{},ignoreWhiteSpace:true,applyToEditableOnly:false,hasClass:function(K){return K.nodeType==1&&b.arrayContains(this.tagNames,K.tagName.toLowerCase())&&D(K,this.cssClass)},getSelfOrAncestorWithClass:function(K){while(K){if(this.hasClass(K,this.cssClass)){return K}K=K.parentNode}return null},isModifiable:function(K){return !this.applyToEditableOnly||c(K)},isIgnorableWhiteSpaceNode:function(K){return this.ignoreWhiteSpace&&K&&K.nodeType==3&&C(K)},postApply:function(X,T,P){var K=X[0],L=X[X.length-1];var N=[],Y;var Q=K,M=L;var V=0,Z=L.length;var O,S;for(var R=0,U=X.length;R<U;++R){O=X[R];S=q(O,!P);if(S){if(!Y){Y=new t(S);N.push(Y)}Y.textNodes.push(O);if(O===K){Q=Y.firstTextNode;V=Q.length}if(O===L){M=Y.firstTextNode;Z=Y.getLength()}}else{Y=null}}var W=k(L,!P);if(W){if(!Y){Y=new t(L);N.push(Y)}Y.textNodes.push(W)}if(N.length){for(R=0,U=N.length;R<U;++R){N[R].doMerge()}T.setStart(Q,V);T.setEnd(M,Z)}},createContainer:function(L){var K=L.createElement(this.elementTagName);g.util.extend(K,this.elementProperties);r(K,this.cssClass);return K},applyToTextNode:function(M){var L=M.parentNode;if(L.childNodes.length==1&&b.arrayContains(this.tagNames,L.tagName.toLowerCase())){r(L,this.cssClass)}else{var K=this.createContainer(b.getDocument(M));M.parentNode.insertBefore(K,M);K.appendChild(M)}},isRemovable:function(K){return K.tagName.toLowerCase()==this.elementTagName&&s(K)==this.elementSortedClassName&&J(K,this.elementProperties)&&!H(K,this.attrExceptions)&&this.isModifiable(K)},undoToTextNode:function(N,L,M){if(!L.containsNode(M)){var K=L.cloneRange();K.selectNode(M);if(K.isPointInRange(L.endContainer,L.endOffset)){E(M,L.endContainer,L.endOffset,[L]);L.setEndAfter(M)}if(K.isPointInRange(L.startContainer,L.startOffset)){M=E(M,L.startContainer,L.startOffset,[L])}}if(this.isRemovable(M)){u(M)}else{m(M,this.cssClass)}},applyToRange:function(L){L.splitBoundaries();var N=B(L);if(N.length){var O;for(var M=0,K=N.length;M<K;++M){O=N[M];if(!this.isIgnorableWhiteSpaceNode(O)&&!this.getSelfOrAncestorWithClass(O)&&this.isModifiable(O)){this.applyToTextNode(O)}}L.setStart(N[0],0);O=N[N.length-1];L.setEnd(O,O.length);if(this.normalize){this.postApply(N,L,false)}}},applyToSelection:function(O){O=O||window;var N=g.getSelection(O);var L,K=N.getAllRanges();N.removeAllRanges();var M=K.length;while(M--){L=K[M];this.applyToRange(L);N.addRange(L)}},undoToRange:function(M){M.splitBoundaries();var O=B(M);var Q,P;var L=O[O.length-1];if(O.length){for(var N=0,K=O.length;N<K;++N){Q=O[N];P=this.getSelfOrAncestorWithClass(Q);if(P&&this.isModifiable(Q)){this.undoToTextNode(Q,M,P)}M.setStart(O[0],0);M.setEnd(L,L.length)}if(this.normalize){this.postApply(O,M,true)}}},undoToSelection:function(P){P=P||window;var O=g.getSelection(P);var L=O.getAllRanges(),M;O.removeAllRanges();for(var N=0,K=L.length;N<K;++N){M=L[N];this.undoToRange(M);O.addRange(M)}},getTextSelectedByRange:function(O,K){var L=K.cloneRange();L.selectNodeContents(O);var M=L.intersection(K);var N=M?M.toString():"";L.detach();return N},isAppliedToRange:function(K){if(K.collapsed){return !!this.getSelfOrAncestorWithClass(K.commonAncestorContainer)}else{var M=K.getNodes([3]);for(var L=0,N;N=M[L++];){if(!this.isIgnorableWhiteSpaceNode(N)&&w(K,N)&&this.isModifiable(N)&&!this.getSelfOrAncestorWithClass(N)){return false}}return true}},isAppliedToSelection:function(N){N=N||window;var M=g.getSelection(N);var K=M.getAllRanges();var L=K.length;while(L--){if(!this.isAppliedToRange(K[L])){return false}}return true},toggleRange:function(K){if(this.isAppliedToRange(K)){this.undoToRange(K)}else{this.applyToRange(K)}},toggleSelection:function(K){if(this.isAppliedToSelection(K)){this.undoToSelection(K)}else{this.applyToSelection(K)}},detach:function(){}};function j(L,M,K){return new h(L,M,K)}h.util={hasClass:D,addClass:r,removeClass:m,hasSameClasses:l,replaceWithOwnChildren:u,elementsHaveSameNonClassAttributes:G,elementHasNonClassAttributes:H,splitNodeAt:E,isEditableElement:p,isEditingHost:d,isEditable:c};g.CssClassApplier=h;g.createCssClassApplier=j});rangy.init()};
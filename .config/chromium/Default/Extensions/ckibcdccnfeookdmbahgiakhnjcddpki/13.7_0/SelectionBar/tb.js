function appendStyle(a,b){style=document.createElement("style");if(b){style.media=b}style.innerText=a;if(document.body){document.body.appendChild(style)}else{$("body").append(style)}}Math.distance=function(c,f,a,d){var b=0;var e=0;b=a-c;b=b*b;e=d-f;e=e*e;return Math.sqrt(b+e)};function createToolBarHTML(){buttons=[{id:"btn_search",text:"s"},{id:"btn_highlight",text:"Ht"},{id:"btn_hide",text:"Hd"},{id:"btn_enlarge",text:"e"},{id:"btn_copy",text:"c"},{id:"btn_crop",text:"crop"},{id:"btn_editcontent",text:"edit"},{id:"btn_print",text:"print"}];html="<table cellSpacing=0 cellPadding=0 style=background-color:#ccc class=myToolbar><tr>";for(i in buttons){html+='<td id="'+buttons[i].id+'" class="tb_btn '+buttons[i].id+'"">';html+=buttons[i].text;html+="</td>"}html+="</tr></table>";return html}x=0;$(function(){appendStyle(".myToolbar .tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden}")});function exec(b){var a=document.createElement("script");a.setAttribute("type","application/javascript");a.textContent=b;document.documentElement.appendChild(a);document.documentElement.removeChild(a)}$(function(){var a=document.createElement("script");a.setAttribute("type","application/javascript");a.src=chrome.extension?chrome.extension.getURL("Zero.js"):"Zero.js";document.documentElement.appendChild(a);document.documentElement.removeChild(a)});$(document).on("mousedown",function(a){removeToolbar=function(){$(".myToolbar").remove();$(window).off("resize.tb");$(document).off(".tb")};removeToolbar();$(document).one("mouseup",function(b){y=true;selection=document.getSelection();rangy.init();if(selection.type!="Range"){removeToolbar();return}text=selection.toString();numOfWords=text.replace(/\t|\n|\r|\-/g," ").replace(/ {2,100}/g," ").trim().split(" ").length;toolbarHTML=createToolBarHTML();$toolbar=$(toolbarHTML);$(".btn_search",$toolbar)[numOfWords<10?"show":"hide"]();$toolbar.appendTo(document.body).css("position","absolute");if(b.pageY>a.pageY){t=b.pageY+15}else{t=b.pageY-$toolbar.height()-15}if(b.pageX>a.pageX){left=b.pageX+15}else{left=b.pageX-$toolbar.width()-15}if(t<0){t=b.pageY-$toolbar.height()-15}if(left<document.body.scrollLeft){left=document.body.scrollLeft}if(t<document.body.scrollTop){document.body.scrollTop-=30}$toolbar.css({left:left,top:t,position:"absolute"});exec('ZeroClipboard.setMoviePath( "'+(chrome.extension?chrome.extension.getURL("ZeroClipboard.swf"):"ZeroClipboard.swf")+'" )');exec("clip=new ZeroClipboard.Client( );");exec("clip.glue( 'btn_copy')");exec("clip.setText(' "+text.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\'/g,"\\'").replace(/\"/g,'\\"')+"' )");exec("clip.addEventListener( 'mouseOver', function() {document.body.setAttribute('clipOver',true)})   ");exec("clip.addEventListener( 'mouseOut', function() {document.body.removeAttribute('clipOver')})   ");$(window).on("resize.tb",function(){clip.reposition()});$toolbar.css("opacity",0.5);centerX=$toolbar.width()/2+$toolbar.position().left;centerY=$toolbar.height()/2+$toolbar.position().top;$(document).on("mousemove.tb",function(c){clipOver=$(document.body).attr("clipOver");dif=Math.distance(centerX,centerY,c.pageX,c.pageY);if(dif>130){$(document).off(".tb");removeToolbar()}else{opacity=(130-dif)/130*2;if(clipOver){opacity=1}$toolbar.css("opacity",opacity)}});$toolbar.on("mousemove",function(c){$toolbar.css("opacity",1);c.stopPropagation();return false});$(".tb_btn",$toolbar).on("mousedown mouseup",function(c){c.stopPropagation();return false});$(".btn_search",$toolbar).one("click",function(){window.open("http://www.google.com/search?q="+text,"_blank")});$(".btn_highlight",$toolbar).one("click",function(){applyClass("tb_highlight");window.getSelection().empty();removeToolbar()});$(".btn_editcontent",$toolbar).one("click",function(){applyClass("editthiscontent");window.getSelection().empty();removeToolbar();$(".editthiscontent").attr("contenteditable",true).removeClass(".editthiscontent")[0].focus()});$(".btn_hide",$toolbar).one("click",function(){applyClass("tb_hide");window.getSelection().empty();removeToolbar()});$(".btn_crop",$toolbar).one("click",function(){rect=window.getSelection().getRangeAt(0).getBoundingClientRect();window.getSelection().empty();removeToolbar();window.crop={};window.crop.x1=rect.left+document.body.scrollLeft;window.crop.y1=rect.top+document.body.scrollTop;window.crop.x2=rect.width+window.crop.x1;window.crop.y2=rect.height+window.crop.y1;window.crop.icons=$("<span><button>Copy Image</button><button>Open Editor</button></span>");showCropOverFlow()});$(".btn_print",$toolbar).one("click",function(){rect="";window.getSelection().empty();$("body").wrap("<ccc><bbb>");media="screen,temp";cutTop=rect.top+$("body").scrollTop();cutLeft=rect.left+$("body").scrollLeft();bodyWidth=$("body").css("width");appendStyle("bbb {margin-top:-"+cutTop+"px;position:absolute}",media);appendStyle("bbb {height:"+(rect.height+cutTop)+"px;position:absolute;overflow:hidden}",media);appendStyle("bbb {margin-left:-"+cutLeft+"px}",media);appendStyle("bbb {width:"+bodyWidth+";position:absolute;overflow:hidden}",media);appendStyle("ccc {height:"+rect.height+"px;position:absolute;overflow:hidden}",media);appendStyle("ccc {width:"+rect.width+"px;position:absolute;overflow:hidden}",media);removeToolbar();window.onfinish=function(){$("body").unwrap().unwrap();$("style[media*=temp]").remove();window.onfinish=null};chrome.runtime.sendMessage({data:"startCapture",type:"scroll"});window.setTimeout(function(){},6000)});$(".btn_enlarge",$toolbar).on("click",function(){var c="rangyTemp_"+(+new Date());applyClass(c);current=parseFloat($("."+c).css("zoom"));newZoom=current?current+0.2:1.2;$("."+c).css({zoom:newZoom})})})});
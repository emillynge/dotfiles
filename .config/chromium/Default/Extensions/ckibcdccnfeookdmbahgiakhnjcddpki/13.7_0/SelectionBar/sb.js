var extStorage={};function extStorageGet(a){return extStorage[a]}function extStorageSet(b,a){if(!chrome.extension){return}extStorage[b]=a;chrome.runtime.sendMessage({data:"storageSet",key:b,val:a})}function extStorageUpdate(){if(!chrome.extension){return}chrome.runtime.sendMessage({data:"storageGet"},function(a){extStorage=a})}extStorageUpdate();applyClass=function(a){var b=rangy.createCssClassApplier(a,true);b.applyToSelection()};Math.distance=function(c,f,a,d){var b=0;var e=0;var b=a-c;var b=b*b;var e=d-f;var e=e*e;return Math.sqrt(b+e)};x=0;function exec(b){var a=document.createElement("script");a.setAttribute("type","application/javascript");a.textContent=b;document.documentElement.appendChild(a);document.documentElement.removeChild(a)}var sbToolbar;func_sbMouseDown=function(a){loadjQuery();loadRangy();loadCropper();removeToolbar=function(){$(".ws_toolbar").remove();if(sbToolbar){sbToolbar.removeToolbar()}sbToolbar=null;$(window).off("resize.tb");$(document).off(".tb")};removeToolbar();$(document).one("keydown",removeToolbar);$(document).one("mouseup",function(b){window.setTimeout(function(){y=true;selection=document.getSelection();if(selection.type!="Range"||selection.isCollapsed||(document.activeElement.contentEditable=="true"||document.activeElement.tagName=="TEXTAREA"||document.activeElement.tagName=="INPUT")){removeToolbar();return}text=selection.toString();if(text.replace(/^\s+|\s+$/g,"")==""){return}numOfWords=text.replace(/\t|\n|\r|\-/g," ").replace(/ {2,100}/g," ").trim().split(" ").length;plugins_to_show=plugins_sb.slice();if(numOfWords>10){plugins_to_show.shift()}$toolbar=$("<div class=ws_toolbar></div>").appendTo(document.body);$(".btn_search",$toolbar)[numOfWords<10?"show":"hide"]();sbToolbar=new Toolbar({plugins:plugins_to_show,element:$toolbar,namespace:"selectionBar",closeOnClick:true,lines:2,enlargable:true,colors:true,button_size:extStorageGet("button_size"),min_buttons_num:4,page_title:$("title").html()||"no title",page_description:"no description",page_url:location.href,icon_base:chrome.extension?chrome.extension.getURL("/pluginDev/icons/"):"../pluginDev/icons/",position:"static",type:"text",request:function(f){f(text)}});if(b.ctrlKey){var c=$.grep(plugins_sb,function(g,f){return g.key=="search"});if(c.length===0){return}createPluginFromObject(c[0]).plugin.run(text);removeToolbar()}if(b.altKey){var c=$.grep(plugins_sb,function(g,f){return g.key=="translate"});if(c.length===0){return}createPluginFromObject(c[0]).plugin.run(text);removeToolbar()}$toolbar.appendTo(document.body).css("position","absolute");function e(j,i){var h,g;var f=20;distanceX=0;if(b.pageY>j.height()+f){h=b.pageY-(j.height()+f)}else{h=b.pageY+f}if(b.pageX>j.width()+distanceX){g=b.pageX-(j.width()+distanceX)}else{h=b.pageX+distanceX}$toolbar.css({left:g,top:h,position:"absolute"})}function d(f){f.css("opacity",extStorageGet("sb_opacity"));var g=object2square(f);$(document).on("mousemove.tb",function(i){clipOver=$(document.body).attr("clipOver");var h={x:i.pageX,y:i.pageY};dif=getDistancePoint2Square(g,h);maxDif=150;if(dif>maxDif){$(document).off(".tb");removeToolbar()}else{opacity=(maxDif-dif)/maxDif*extStorageGet("sb_opacity");if(clipOver){opacity=1}f.css("opacity",opacity)}f.on("mousemove",function(j){f.css("opacity",1);j.stopPropagation()})})}e($toolbar,b);d($toolbar);return;$(".btn_print",$toolbar).one("click",function(){rect="";window.getSelection().empty();$("body").wrap("<ccc><bbb>");media="screen,temp";cutTop=rect.top+$("body").scrollTop();cutLeft=rect.left+$("body").scrollLeft();bodyWidth=$("body").css("width");appendStyle("bbb {margin-top:-"+cutTop+"px;position:absolute}",media);appendStyle("bbb {height:"+(rect.height+cutTop)+"px;position:absolute;overflow:hidden}",media);appendStyle("bbb {margin-left:-"+cutLeft+"px}",media);appendStyle("bbb {width:"+bodyWidth+";position:absolute;overflow:hidden}",media);appendStyle("ccc {height:"+rect.height+"px;position:absolute;overflow:hidden}",media);appendStyle("ccc {width:"+rect.width+"px;position:absolute;overflow:hidden}",media);removeToolbar();window.onfinish=function(){$("body").unwrap().unwrap();$("style[media*=temp]").remove();window.onfinish=null};chrome.runtime.sendMessage({data:"startCapture",type:"scroll"});window.setTimeout(function(){},6000)})},0)})};function func_sbKeyDown(f){if(f.altKey&&f.ctrlKey&&f.shiftKey&&f.keyCode-48>=0&&f.keyCode-48<=9){loadjQuery();thisNum=f.keyCode-48;var c,h,a=0;if(thisNum===0){c="search";h=true}if(thisNum===1){c="translate";h=true}if(thisNum===2){c="share";h=true}if(thisNum===3){c="crop";a=1000}var b=$.grep(plugins_sb,function(i,e){return i.key==c});if(b.length===0){return}b=createPluginFromObject(b[0]).plugin;var d=new jQuery.Event();d.pageX=document.body.scrollLeft+$(document.body).width()/2;d.pageY=document.body.scrollTop+$(document.body).height()/2;var g="";if(h){if(window.getSelection().type=="Range"){g=window.getSelection().getRangeAt(0).toString()}if(!g){g=prompt("Enter text")}if(!g){return}}window.setTimeout(function(){b.run(g,d)},a)}}function sb_pause(){document.removeEventListener("mousedown",func_sbMouseDown);document.removeEventListener("keydown",func_sbKeyDown)}chrome.runtime.connect().onDisconnect.addListener(sb_pause);function sb_start(){sb_pause();document.addEventListener("mousedown",func_sbMouseDown);document.addEventListener("keydown",func_sbKeyDown)}function getDistancePoint2Square(d,b){var c=d,e=b;function a(){if(!d||!b){throw"You must enter square and point"}if(c.x1>c.x2||c.y1>c.y2){throw"x2 and y2 must be greater than x1 and y1"}}var f=function(){if(e.x>c.x1&&e.x<c.x2&&e.y>c.y2){return e.y-c.y2}if(e.x>c.x1&&e.x<c.x2&&e.y<c.y1){return c.y1-e.y}if(e.y>c.y1&&e.y<c.y2&&e.x<c.y1){return c.x1-e.x}if(e.y>c.y1&&e.y<c.y2&&e.x>c.x2){return e.x-c.x2}if(e.y<c.y1&&e.x<c.x1){return g(e.x,e.y,c.x1,c.y1)}if(e.y<c.y1&&e.x>c.x2){return g(e.x,e.y,c.x2,c.y1)}if(e.y>c.y2&&e.x<c.x1){return g(e.x,e.y,c.x1,c.y2)}if(e.y>c.y2&&e.x>c.x2){return g(e.x,e.y,c.x2,c.y2)}};var g=function(j,m,h,k){var i=0;var l=0;var i=h-j;var i=i*i;var l=k-m;var l=l*l;return Math.sqrt(i+l)};a();return f()}function object2square(c){var a={};var b=$(c);a.x1=b.position().left;a.x2=a.x1+b.width();a.y1=b.position().top;a.y2=a.y1+b.height();return a};
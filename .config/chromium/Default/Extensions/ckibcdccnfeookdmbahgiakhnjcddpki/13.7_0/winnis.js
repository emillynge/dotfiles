var i=0;var b=0;var ii=0;var lastMouseX=0;var lastMouseY=0;function findAndShowDirs(a){if(navigator.appVersion.indexOf("Win")!=-1){this.windows=true}if(navigator.appVersion.indexOf("Mac")!=-1){this.mac=true}if(navigator.appVersion.indexOf("X11")!=-1){this.x11=true}if(navigator.appVersion.indexOf("Linux")!=-1){this.linux=true}if(this.windows){this.rootDir="";this.dirSep="\\"}else{this.dirSep="/";this.rootDir="/"}this.newDir="";this.ranDir="";this.strSlc;this.dirArr=new Array;this.currentPath="";this.chosenDir="";this.newDir="";this.firstTime=true;this.pathSerNum=0;this.pathArr=new Array();this.content="";this.whereTo="body";theObject=this;this.minListWidth=544;this.minListHeight=120;this.load=load;this.enterDir=enterDir;this.makingList=makingList;this.returnDir=returnDir;this.backDir=backDir;this.forwardDir=forwardDir;this.storePath=storePath;this.chooseDir=chooseDir;this.cancelButton=cancelButton;this.openWin=openWin;this.saveStart=saveStrat;this.resize=resize;this.resizing=resizing;this.appendTo=appendTo;this.content='<div id="outerDiv">	  <div id="upperSide">  	  <div id="sourceDiv"></div>  	  <img src="dirout.gif" class="myWindowButton" onClick="saveNow.returnDir()" title="up">  	  <img src="arrowleft.gif" class="myWindowButton" onClick="saveNow.backDir()" title="backward">  	  <img src="arrowright.gif" class="myWindowButton" onClick="saveNow.forwardDir()"title="forward">  	  </div>  	  	<div id="listDiv"></div>  	  	    	  <input type="button" id="openDir" value="open directory" onClick="saveNow.enterDir();saveNow.load();saveNow.makingList();"/>  	  	    	  <input type="button" value="choose" onClick="saveNow.chooseDir();"/>  	  	    	  <input type="button" value="cancel" onClick="cancelButton();"/>  	  </div>';this.whereTo=".window-content";this.getDriveLetters=function(){return JSON.parse(this.plugin.runCommand("cmd /c for %i in (a b c d e f g h i j k l m n o p q r s t u v w x y z) do @%i: 2>nul && set/pz=%i <nul",true)).bytes.replace(/([a-z])/gi,"$1:").split(" ").slice(0,-1)}}function load(){folderName=this.currentPath;myFolderList=plugin.getFileList(folderName);if(this.currentPath!=""){myFolderList=myFolderList.slice(myFolderList.lastIndexOf(":[")+2,myFolderList.lastIndexOf('"')-1);myFolderList=myFolderList.replace(/"/g,"");this.dirArr=myFolderList.split(",");this.dirArr=this.dirArr.sort()}else{this.dirArr=this.getDriveLetters()}console.log(this.dirArr);$("#sourceDiv").empty();$("#sourceDiv").append("<span>"+this.currentPath+"</span>");i=0}function enterDir(){if(this.newDir!=""){this.currentPath=this.currentPath+this.newDir+this.dirSep;this.storePath()}else{alert("no directory had chosen!");$("#sourceDiv").empty();$("#sourceDiv").append("<div>"+this.currentPath+"</div>")}this.firstTime=false}function makingList(){$("#listDiv").empty();listI=0;while(listI<this.dirArr.length){if(this.dirArr[listI]!="."&&this.dirArr[listI]!=".."){dirNum="dir"+listI;$("#listDiv").append('<sapn class="divDirList"><img src="directory.gif" style={width:8px,height:8px}>'+this.dirArr[listI]+"</span><br/>")}listI++}$(".divDirList").click(function(){$(".divDirList").css({border:"none","background-color":"white"});$(this).css({border:"black dotted 1px","background-color":"lightblue"});theObject.newDir=$(this).text()});$(".divDirList").dblclick(function(){theObject.newDir=$(this).text();theObject.enterDir();theObject.load();theObject.makingList()});this.newDir=""}function returnDir(){if(this.currentPath.toLowerCase()!=this.rootDir.toLowerCase()){this.currentPath=this.currentPath.slice(0,this.currentPath.lastIndexOf(this.dirSep));this.currentPath=this.currentPath.slice(0,(this.currentPath.lastIndexOf(this.dirSep)+1));this.storePath();this.load();this.makingList()}}function backDir(){if(this.pathSerNum>0){this.pathSerNum-=1;this.currentPath=this.pathArr[this.pathSerNum];this.load();this.makingList()}}function forwardDir(){if(this.pathArr[this.pathSerNum+1]!=undefined){this.pathSerNum+=1;this.currentPath=this.pathArr[this.pathSerNum];this.load();this.makingList()}}function storePath(){this.pathSerNum+=1;this.pathArr[this.pathSerNum]=this.currentPath}function chooseDir(){if(this.newDir!=""){this.currentPath+=this.newDir+this.dirSep}this.chosenDir=this.currentPath;localStorage.lastPath=this.chosenDir;this.onChoose(this.chosenDir);this.cancelButton()}function cancelButton(){if(this.onClose){this.onClose()}$(".window-closeButton").trigger("click")}function appendTo(c){$(c).append(this.content)}function openWin(){$("#cover").show().css({width:$(window).width()+17,height:$(window).height()+17});saveNow.pathArr[0]=saveNow.currentPath;$.newWindow({id:"bam",title:"Choose a directory",width:580,height:220,posx:100,posy:100,content:"",onDragBegin:null,onDragEnd:null,onResizeBegin:null,onResizeEnd:null,onAjaxContentLoaded:null,statusBar:true,minimizeButton:false,maximizeButton:false,closeButton:true,draggable:true,resizeable:true});$(".window-closeButton").click(function(){$("#cover").hide()})}function saveStrat(){plugin=this.plugin;js=JSON.parse(plugin.getTempFolder());this.currentPath=localStorage.lastPath||js.tempfolder;if(!this.windows){if(this.currentPath.slice(-1)!="/"){this.currentPath+="/"}}js1=JSON.parse(plugin.setPath(this.currentPath));if(js1.errorcode!=0){plugin.setPath(js.tempfolder)}openWin();this.appendTo(this.whereTo);this.load();this.makingList();$(".myWindowButton").mousedown(function(){$(this).css("border","inset rgb(192,192,252)")});$(".myWindowButton").mouseup(function(){$(this).css("border","outset rgb(192,192,252)")});$windowResizeIcon.bind("mousedown",function(a){$lobj=$("#listDiv");lastMouseX=a.clientX;lastMouseY=a.clientY;$(document).bind("mousemove",function(c){theObject.resizing(c,$lobj)})})}$(document).ready(function(){$(".myButton").mousedown(function(){$(this).css("border","inset")});$(".myButton").mouseup(function(){$(this).css("border","outset")})});$(function(){$(".myButton").mousedown(function(){$(this).css("border","inset")});$(".myButton").mouseup(function(){$(this).css({border:"outset rgb(192,192,192)"})})});function resize(d,c,a){c=parseInt(c);if(c<this.minListWidth){c=this.minListWidth}a=parseInt(a);if(a<this.minListHeight){a=this.minListHeight}d.data("lastWidth",c).data("lastHeight",a);d.css("width",c+"px").css("height",a+"px")}function resizing(g,j){g=g?g:window.event;var c=parseInt(j.css("width"));var f=parseInt(j.css("height"));c=c<50?50:c;f=f<20?20:f;$("#a").text(c+" "+f);var a=c+(g.clientX-lastMouseX);var d=f+(g.clientY-lastMouseY);$("#a").text(c+" "+f);lastMouseX=g.clientX;lastMouseY=g.clientY;this.resize(j,a,d)};
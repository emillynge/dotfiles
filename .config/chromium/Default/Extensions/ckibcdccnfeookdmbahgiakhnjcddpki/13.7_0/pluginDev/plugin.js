_gaq=window._gaq||[];var buttons_colors=["#F3B200","#77B900","#2572EB","#AA4344","#7F6E94","#199900","#FF981D","#AA40FF","#91D100","#E1B700","#FF76BC","#56C5FF","#00C13F","#FE7C22"];var sizes={4:16,5:20,6:24};function createPluginFromText(text){try{eval("var newPlugin="+text);if(!newPlugin.key){newPlugin.key="demoplugin"}}catch(e){return{error:e.toString()}}return createPluginFromObject(newPlugin)}function createPluginFromObject(a){if(!window.extStorageGet){window.extStorageGet=function(b){return localStorage[b]};window.extStorageSet=function(c,b){return localStorage[c]=b}}if(!a.key){return({error:'You Don\'t have a "key" key',id:4})}if(!a.onclick&&(!a.url)){return{error:"You don't have a onclick function or url key",id:1}}if(!a.name){return{error:'You must add a "name" key',id:2}}dataTypes=a.dataType||"";dataTypes=dataTypes.replace(/text/g,"");dataTypes=dataTypes.replace(/image_url/g,"");dataTypes=dataTypes.replace(/image/g,"");dataTypes=dataTypes.replace(/page/g,"");dataTypes=dataTypes.replace(/image_base64/g,"");dataTypes=dataTypes.trim(dataTypes);if(dataTypes.length>0){return{error:"Cannot recognize dataType: "+dataTypes}}a=$.extend({dataType:"text image_url",isDataType:function(b){return(this.dataType.toLowerCase().indexOf(b.toLowerCase())>-1)},dataTypes:function(){return(this.dataType.split(" "))},run:function(b,f){if(this.toolbar){var e=this.toolbar.namespace+"_"+this.key+"_run";if(!extStorageGet(e)){extStorageSet(e,0)}extStorageSet(e,parseInt(extStorageGet(e),10)+1);chrome.runtime.sendMessage({data:"ana",array:["_setCustomVar","pluginClicks",extStorageGet(e),1],});chrome.runtime.sendMessage({data:"ana",array:["_trackEvent","pluginRun",this.name]})}for(var d in sb){this[d]=sb[d]}var g=a;g.event=f;g.page_title=(this.toolbar&&this.toolbar.page_title)||$("title").text()||"no title";g.page_description=(this.toolbar&&this.toolbar.page_description)||$("meta[name=description]").attr("content")||"";g.page_url=(this.toolbar&&this.toolbar.page_url)||location.toString();if(this.isDataType("text")){g.text=b;g.dataType="text";if(this.onclick){this.onclick(g)}else{if(this.url){this.createTabWithParams(this.url,b,g)}}}else{if(this.isDataType("image")){g.image_url=function(i){var h=this.image_data();if(this.toolbar&&h==this.toolbar.last_image_data){i(this.toolbar.last_image_url);return}$.ajax({url:"http://www.webpagescreenshot.info/upload3.asp",type:"post",data:{type:"png",title:g.page_title,description:g.page_description,imageUrl:g.page_url,options:extStorageGet("options"),data:h}}).done(function(k,j,m){var l=k.replace(/^\s+|\s+$/g,"");if(/"/.test(l)||/>/.test(l)||/</.test(l)||/'/.test(l)||l.indexOf("http:")!=0){alert("error in upload")}else{l=l.split(",");imageURL=l[0];if(g.toolbar){g.toolbar.last_image_data=h;g.toolbar.last_image_url=imageURL}i(imageURL)}})};g.image_base64=function(j){var i=this.image_data();var h=i.slice(i.indexOf(",")+1);if(j){j(h)}return h};if(Array.isArray(b)||b.jquery){b=b[0]}if(typeof b=="string"&&b.slice(0,4)=="data"){g.image_data=function(h){if(h){h(b)}return b}}else{if(b.nodeType){var c;if(b.tagName=="IMG"){c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0)}if(b.tagName=="CANVAS"){c=b}if(b.tagName=="CANVAS"||b.tagName=="IMG"){g.image_data=function(i){var h=c.toDataURL();if(i){i(h)}return h}}else{alert("plugin tag get no supported:"+b.tagName)}}}if(this.url){g.image_url(function(h){g.createTabWithParams(g.url,h,g)})}if(this.onclick){if(this.dataType=="image"){g.dataType="image"}this.onclick(g)}}else{if(this.onclick){this.onclick(g)}}}}},a);return{plugin:a}}sb={applyClass:function(a){var b=rangy.createCssClassApplier(a,true);b.applyToSelection()},createTabWithParams:function(b,c,a){var d=this.url;d=d.replace(/{image_url}/g,"%c");d=d.replace(/{page_url}/g,encodeURIComponent(this.page_url));d=d.replace(/{page_title}/g,encodeURIComponent(this.page_title));d=d.replace(/{page_description}/g,encodeURIComponent(this.page_description));d=d.replace(/{text}/g,encodeURIComponent(this.text));d=d.replace(/%s/g,c).replace("%c",encodeURIComponent(c.replace("img","i3"))).replace(/%t/g,encodeURIComponent(a.title));console.log(d);this.createTab(d)},createTab:function(a){window.open(a,"_blank")},dialog:function(d,c){d=$(d);$("input",d).not("[type=password]").inputLoadAndRemember(this);var b=$.extend({},c,{element:d,ui:"dialog",title:this.name});var a=new Dialog(b);a.show();$("input",a.contentDocument).first().focus();return a},dialog3:function(c){c=$(c);$("input",c).not("[type=password]").inputLoadAndRemember(this);iframe=document.createElement("iframe").appendTo(document.body);iframe.style.position="absolute";iframe.frameBorder=0;document.body.appendChild(iframe);$(iframe).position({of:document});var e=$('<div style=width:inherit class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable"><div style=cursor:default class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id=title class="ui-dialog-title"></span><button  class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span style=margin:-8px class="ui-button-icon-primary ui-icon ui-icon-closethick"></span></button></div><div id=content class="ui-dialog-content ui-widget-content"></div></div>');iframe.contentDocument.body.appendChild(e[0]);$("[title=close]",e).click(function(){b()});$("#content",iframe.contentDocument.body).append(c[0]);$("#title",iframe.contentDocument.body).html("Hello World");e=document.createElement("div");e.innerHTML='<link rel="stylesheet" href="jquery-ui-1.9.2.custom.min.css"></link><style>body {color:white;}</style>';iframe.contentDocument.body.appendChild(e);var b=function(){iframe.remove()};var a=function(f){if(f.keyCode==27){b()}document.removeEventListener("keyup",a)};document.addEventListener("keyup",a);iframe.contentDocument.addEventListener("keyup",a);var d=function(){iframe.style.height=iframe.contentDocument.height+"px";iframe.style.width=iframe.contentDocument.width+"px"};d();$("input",iframe.contentDocument).first().focus()},dialog2:function(a){a=$(a).wrap('<div class="noCss">').parent();$("input",a).not("[type=password]").inputLoadAndRemember(this);$("button",a).button();a.dialog({modal:true,minWidth:460,title:this.name+" - Selection Bar"});return $(a)},storageGet:function(b,d){var c=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+b;var a;if(extStorageGet){a=extStorageGet(c)}else{a=localStorage[c]}if(a===undefined){a=d}return isNumber(a)?parseFloat(a):a},storageSetDefault:function(a,b){if(this.storageGet(a)==undefined){this.storageSet(a,b)}},storageSet:function(a,c){var b=(this.toolbar&&this.toolbar.namespace)+"_"+this.key+"_"+a;if(extStorageSet){return extStorageSet(b,c)}else{return localStorage[b]=c}}};function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)}var sb_plugins={};function addObjectToPlugins(a){if(!Array.isArray(a)){a=[a]}$.each(a,function(){var b=this;newPlugin=createPluginFromObject(b);if(newPlugin.error){console.log("cannot add plugin, error",newPlugin.error);return}newPlugin=newPlugin.plugin;sb_plugins[newPlugin.key]=newPlugin})}jQueryThingsLoaded=false;loadjQueryThings=function(){if(jQueryThingsLoaded){return}jQueryThingsLoaded=true;$.ajaxPrefilter(function(e,b,f){if(e.showProgress){var d=$("<center class=progresscancel><div>Saving Online...<br><div style=height:20px;background-color:skyblue name=progressbar></div><button name=cancel>Cancel</button></div></center>");var c=new Dialog({title:"Uploading",ui:"dialog",element:d,onclose:function(){f.abort()}}).show();var a=$("[name=progressbar]",d);a.css({width:"0%"});function g(h){a.css({width:h+"%"})}e.xhr=function(){var h=new XMLHttpRequest;h.upload.onprogress=function(k){var j=k.total;var i=k.loaded;g(k.loaded/k.total*98)};return h};f.fail(function(){$("[name=status]",d).html("Cannot upload. Try again later")});f.done(function(){c.remove()});$("[name=cancel]",d).click(function(){c.remove();f.abort()})}});$.ajaxSetup({showProgress:true});$.fn.inputLoadAndRemember=function(a){this.each(function(){if(this.getAttribute("name").length<1){console.log('Every input must have "name" Attribute')}else{$(this).val(a.storageGet(this.getAttribute("name")));$(this).on("input",function(){a.storageSet(this.getAttribute("name"),$(this).val())})}})}};function Toolbar(j){loadjQueryThings();this.obj_plugins={};var a="";var f=[];a=$('<div style="border:1px solid #8b8b8b;;-webkit-border-radius: 3px;display: inline-block; background:-webkit-linear-gradient(top, #f8f8f8 0%,#cfcfcf 100%);"></div>');var e=this;function d(){var l;a.html("");a.css("z-index",e.zIndex);var k=0;var m=0;$.each(e.obj_plugins,function(p,o,s){this.dataTypes=this.dataType.split(" ");for(var r in f){for(var q in this.dataTypes){if(f[r]==this.dataTypes[q]){m++}}}});var n=-1;$.each(e.obj_plugins,function(p,o,u){var t=false;for(var s in f){for(var r in this.dataTypes){if(f[s]==this.dataTypes[r]){t=true}}}if(!t){return}l=$('<div style=float:left><img class=tb_button plugin-key="'+this.key+'"src='+e.icon_base+(this.key+".png")+" ></div>");k++;$("img",l).attr("width",j.button_size+"px");$("img",l).attr("height",j.button_size+"px");$("img",l).css("width",j.button_size+"px");$("img",l).css("height",j.button_size+"px");l.attr("title",this.name);var q=this;$("img",l).on({error:function(){},mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")},"mousedown mouseup":function(v){v.stopPropagation()},click:function(v){e.request(function(w){if(q.closeOnClick===false){v.stopPropagation()}q.run(w,v)})}});n++;if(j.colors===true){thisColorIndex=n;if(thisColorIndex>=buttons_colors.length){thisColorIndex=0}$("img",l).css("backgroundColor",buttons_colors[thisColorIndex])}a.append(l);if(Math.round(m/this.toolbar.lines+1)==k){l.css("clear","both")}});if(j.enlargable){c=$('<div style=cursor:pointer;float:left><img style="margin:-5px"  src='+e.icon_base+"right.png></div>");g=$('<div style=cursor:pointer;float:left><img style="margin:-5px" src='+e.icon_base+"left.png></div>");a.append(c).append(g);h();c.add(g).find("img").css("height",j.button_size).on("mousedown",function(o){o.stopPropagation()});c.on("click",function(o){e.storageSet("isMax","yes");h();return false});g.on("click",function(o){e.storageSet("isMax","no");h();return false})}}var c,g;var h=function(){if(e.isMax()){g.show();c.hide();$(".tb_button",a).parent().show()}else{g.hide();c.show();$(".tb_button",a).parent().hide().slice(0,j.min_buttons_num).show()}};this.isMax=function(){return e.storageGet("isMax")=="yes"};this.addPlugins=function(k){if(!Array.isArray(k)){k=[k]}$.each(k,function(){var l=this;newPlugin=createPluginFromObject(l);if(newPlugin.error){console.log("cannot add plugin, error",newPlugin.error,newPlugin);return}newPlugin=newPlugin.plugin;newPlugin.toolbar=e;e.obj_plugins[newPlugin.key]=newPlugin})};this.removeToolbar=function(){$(j.element).html("");$(document).off("click",e.removeToolbar)};var b=function(){window.setTimeout(function(){$(document).on("click",e.removeToolbar)},0)};var i=function(){f=j.type.split(" ");j=$.extend({},{icon_base:"icons/",lines:1,min_buttons_num:2,zIndex:20000,button_size:20},j);for(var k in j){this[k]=j[k]}this.request==this.request||this.requestImage;this.addPlugins(j.plugins);if(this.position=="static"){d();$(j.element).append(a)}if(j.closeOnClick){b()}};this.getPluginByKey=function(k){if(this.obj_plugins[k]){return this.obj_plugins[k]}};this.storageGet=function(l,n){var m=(this.namespace&&"toolbarnonamespace")+"_"+l;var k;if(extStorageGet){k=extStorageGet(m)}else{k=localStorage[m]}if(k===undefined){k=n}return isNumber(k)?parseFloat(k):k},this.storageSetDefault=function(k,l){if(this.storageGet(k)==undefined){this.storageSet(k,l)}},this.storageSet=function(k,m){var l=(this.namespace&&"toolbarnonamespace")+"_"+k;if(extStorageSet){return extStorageSet(l,m)}else{return localStorage[l]=m}};i.call(this)}function appendStyle(a,b){style=document.createElement("style");if(b){style.media=b}style.innerText=a;if(document.body){document.body.appendChild(style)}}function appendFirstStyle(){style=document.createElement("style");var a="";a+=".tb_button {padding:1px;cursor:pointer;border-right: 1px solid #8b8b8b;border-left: 1px solid #FFF;border-bottom: 1px solid #fff;}";a+=".tb_button.hover {borer:2px outset #def; background-color: #f8f8f8 !important;}";a+=".ws_toolbar {z-index:100000} .ws_toolbar .ws_tb_btn {cursor:pointer;border:1px solid #555;padding:3px}   .tb_highlight{background-color:yellow} .tb_hide {visibility:hidden} .ws_toolbar img {padding:2px;margin:0px}";appendStyle(a)}if(document.readyState=="complete"){appendFirstStyle()}else{window.addEventListener("load",appendFirstStyle)};